
////////////////////////////////////////////////////////////
// FEUPAutom - 5.9.0.90 - 
// Code Automatically Generated:02-07-2018 19:03:46
////////////////////////////////////////////////////////////

//######################################//
//################ Page 3 ##############//
//######################################//

////////////////////////////////////////////////////////////
///////////// If boot => Set Initial Steps /////////////////
//####################### Page 3 ########################//
////////////////////////////////////////////////////////////

  if( (_SysWords[0]==0) ) {
  };
if( (_SysWords[0]>0) ) {  // ** Prevent evolution in initial cycle

////////////////////////////////////////////////////////////
///////////////// Calc Fired Transitions ///////////////////
//####################### Page 3 ########################//
////////////////////////////////////////////////////////////

}; //** Prevent evolution in initial cycle

////////////////////////////////////////////////////////////
///////////////// ReSet Steps Above fired Tr ///////////////
//####################### Page 3 ########################//
////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////
///////////////// Set Steps below fired Tr /////////////////
//####################### Page 3 ########################//
////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////
////////// Unset all Outputs (once for all pages) //////////
//####################### Page 3 ########################//
////////////////////////////////////////////////////////////

  _OutBits[0]=0;
  _OutBits[1]=0;
  _OutBits[2]=0;
  _OutBits[3]=0;
  _OutBits[4]=0;
  _OutBits[5]=0;
  _OutBits[6]=0;
  _OutBits[7]=0;
  _OutBits[8]=0;
  _OutBits[9]=0;
  _OutBits[10]=0;
  _OutBits[11]=0;
  _OutBits[12]=0;
  _OutBits[13]=0;
  _OutBits[14]=0;
  _OutBits[15]=0;
  _OutBits[16]=0;
  _OutBits[17]=0;
  _OutBits[18]=0;
  _OutBits[19]=0;
  _OutBits[20]=0;
  _OutBits[21]=0;
  _OutBits[22]=0;
  _OutBits[23]=0;
  _OutBits[24]=0;
  _OutBits[25]=0;
  _OutBits[26]=0;
  _OutBits[27]=0;
  _OutBits[28]=0;
  _OutBits[29]=0;
  _OutBits[30]=0;
  _OutBits[31]=0;
  _OutBits[32]=0;
  _OutBits[33]=0;
  _OutBits[34]=0;
  _OutBits[35]=0;
  _OutBits[36]=0;
  _OutBits[37]=0;
  _OutBits[38]=0;
  _OutBits[39]=0;
  _OutBits[40]=0;
  _OutBits[41]=0;
  _OutBits[42]=0;
  _OutBits[43]=0;
  _OutBits[44]=0;
  _OutBits[45]=0;
  _OutBits[46]=0;
  _OutBits[47]=0;

////////////////////////////////////////////////////////////
///// If step active increment MW timer of step @ %s16 /////
//####################### Page 3 ########################//
////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////
//////// If step active, execute its action code ///////////
//####################### Page 3 ########################//
////////////////////////////////////////////////////////////


//######################################//
//################ Page 2 ##############//
//######################################//

////////////////////////////////////////////////////////////
///////////// If boot => Set Initial Steps /////////////////
//####################### Page 2 ########################//
////////////////////////////////////////////////////////////

  if( (_SysWords[0]==0) ) {
  };
if( (_SysWords[0]>0) ) {  // ** Prevent evolution in initial cycle

////////////////////////////////////////////////////////////
///////////////// Calc Fired Transitions ///////////////////
//####################### Page 2 ########################//
////////////////////////////////////////////////////////////

}; //** Prevent evolution in initial cycle

////////////////////////////////////////////////////////////
///////////////// ReSet Steps Above fired Tr ///////////////
//####################### Page 2 ########################//
////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////
///////////////// Set Steps below fired Tr /////////////////
//####################### Page 2 ########################//
////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////
///// If step active increment MW timer of step @ %s16 /////
//####################### Page 2 ########################//
////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////
//////// If step active, execute its action code ///////////
//####################### Page 2 ########################//
////////////////////////////////////////////////////////////


//######################################//
//################ Page 1 ##############//
//######################################//

////////////////////////////////////////////////////////////
///////////// If boot => Set Initial Steps /////////////////
//####################### Page 1 ########################//
////////////////////////////////////////////////////////////

  if( (_SysWords[0]==0) ) {
  };
if( (_SysWords[0]>0) ) {  // ** Prevent evolution in initial cycle

////////////////////////////////////////////////////////////
///////////////// Calc Fired Transitions ///////////////////
//####################### Page 1 ########################//
////////////////////////////////////////////////////////////

}; //** Prevent evolution in initial cycle

////////////////////////////////////////////////////////////
///////////////// ReSet Steps Above fired Tr ///////////////
//####################### Page 1 ########################//
////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////
///////////////// Set Steps below fired Tr /////////////////
//####################### Page 1 ########################//
////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////
///// If step active increment MW timer of step @ %s16 /////
//####################### Page 1 ########################//
////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////
//////// If step active, execute its action code ///////////
//####################### Page 1 ########################//
////////////////////////////////////////////////////////////


//######################################//
//################ Page 0 ##############//
//######################################//

////////////////////////////////////////////////////////////
////////////////////////// Zone1 ///////////////////////////
//####################### Page 0 ########################//
////////////////////////////////////////////////////////////

 if( (_SysWords[0]==0) ) {
   calibrate();
 };
 

////////////////////////////////////////////////////////////
///////////// If boot => Set Initial Steps /////////////////
//####################### Page 0 ########################//
////////////////////////////////////////////////////////////

  if( (_SysWords[0]==0) ) {
  // ObjIdx=0 => INI_Step "X1"
    _MemBits[0] = 1;
  };
if( (_SysWords[0]>0) ) {  // ** Prevent evolution in initial cycle

////////////////////////////////////////////////////////////
///////////////// Calc Fired Transitions ///////////////////
//####################### Page 0 ########################//
////////////////////////////////////////////////////////////

// ObjIdx=1 => Transition "t0"
  // Steps Above: id=0 => X1 ;
  // Steps Below: id=2 => X2 ;
  _MemBits[1] =  _MemBits[0] &&  (_InBits[1]);
// ObjIdx=3 => Transition "t1"
  // Steps Above: id=2 => X2 ;
  // Steps Below: id=0 => X1 ;
  _MemBits[3] =  _MemBits[2] &&  (_InBits[0] || _InBits[2]);
}; //** Prevent evolution in initial cycle

////////////////////////////////////////////////////////////
///////////////// ReSet Steps Above fired Tr ///////////////
//####################### Page 0 ########################//
////////////////////////////////////////////////////////////

// ObjIdx=1 => Transition "t0"
  // Steps Above: id=0 => X1 ;
  // Steps Below: id=2 => X2 ;
  if( (_MemBits[1]) ) {
     _MemBits[0]=0; 
  };
// ObjIdx=3 => Transition "t1"
  // Steps Above: id=2 => X2 ;
  // Steps Below: id=0 => X1 ;
  if( (_MemBits[3]) ) {
     _MemBits[2]=0; 
  };

////////////////////////////////////////////////////////////
///////////////// Set Steps below fired Tr /////////////////
//####################### Page 0 ########################//
////////////////////////////////////////////////////////////

// ObjIdx=1 => Transition "t0"
  // Steps Above: id=0 => X1 ;
  // Steps Below: id=2 => X2 ;
  if( (_MemBits[1]) ) { 
    _MemBits[2] = 1; 
    _MemWords[2] = 0; 
  };
// ObjIdx=3 => Transition "t1"
  // Steps Above: id=2 => X2 ;
  // Steps Below: id=0 => X1 ;
  if( (_MemBits[3]) ) { 
    _MemBits[0] = 1; 
    _MemWords[0] = 0; 
  };

////////////////////////////////////////////////////////////
///// If step active increment MW timer of step @ %s16 /////
//####################### Page 0 ########################//
////////////////////////////////////////////////////////////

  // ObjIdx=0 => Step "X1"
  if( (_SysBits[16]) && (_MemBits[0]) ) { 
    _MemWords[0] = _MemWords[0]+1;
  };
  // ObjIdx=2 => Step "X2"
  if( (_SysBits[16]) && (_MemBits[2]) ) { 
    _MemWords[2] = _MemWords[2]+1;
  };
  // ObjIdx=6 => Step "Zone8"
  if( (_SysBits[16]) && (_MemBits[6]) ) { 
    _MemWords[6] = _MemWords[6]+1;
  };
  // ObjIdx=7 => Step "Zone1"
  if( (_SysBits[16]) && (_MemBits[7]) ) { 
    _MemWords[7] = _MemWords[7]+1;
  };

////////////////////////////////////////////////////////////
//////// If step active, execute its action code ///////////
//####################### Page 0 ########################//
////////////////////////////////////////////////////////////

  // ObjIdx=6 => Step "Zone8" (code...)
  if( _MemBits[6] ) { 
    v = 160 - 0.03 * abs(2000.0 - position);
    
    w = -0.05 * (2000.0 - position);
    
    
    
    v1 = v + w;
    
    v2 = v - w;
    
    
    
    if( (v1 >255) ) {
    
      v1= 255;
    
    };
    
    if( (v1<-255) ) {
    
      v1=-255;
    
    };
    
    if( (v2 >255) ) {
    
      v2= 255;
    
    };
    
    if( (v2<-255) ) {
    
      v2=-255;
    
    };
    
    if( _MemBits[2] ) {
    
      set_motors(v1, v2);
    
    } else {
    
      set_motors(0, 0);
    
    };
    
    
    
    if( ((_SysWords[0] % 50)==0) ) {
    
      clear();
    
      printf("%3d %3d",v1,v2);
    
      lcd_goto_xy(0,1);
    
      printf("%04d %d%d", position, _MemBits[0], _MemBits[2]);
    
    };
    
              
    
  };
  // ObjIdx=7 => Step "Zone1" (code...)
  if( _MemBits[7] ) { 
    if( (_SysWords[0]==0) ) {
      calibrate();
    };
    
  };

////////////////////////////////////////////////////////////
////////////////////////// Zone8 ///////////////////////////
//####################### Page 0 ########################//
////////////////////////////////////////////////////////////

 v = 160 - 0.03 * abs(2000.0 - position);
 
 w = -0.05 * (2000.0 - position);
 
 
 
 v1 = v + w;
 
 v2 = v - w;
 
 
 
 if( (v1 >255) ) {
 
   v1= 255;
 
 };
 
 if( (v1<-255) ) {
 
   v1=-255;
 
 };
 
 if( (v2 >255) ) {
 
   v2= 255;
 
 };
 
 if( (v2<-255) ) {
 
   v2=-255;
 
 };
 
 if( _MemBits[2] ) {
 
   set_motors(v1, v2);
 
 } else {
 
   set_motors(0, 0);
 
 };
 
 
 
 if( ((_SysWords[0] % 50)==0) ) {
 
   clear();
 
   printf("%3d %3d",v1,v2);
 
   lcd_goto_xy(0,1);
 
   printf("%04d %d%d", position, _MemBits[0], _MemBits[2]);
 
 };
 
           
 

/*************** } of ST Code ****************/
